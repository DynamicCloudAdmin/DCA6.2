AVD FSLogix Configuration Consistency Assessment#CredCode#$ScopedHostPools = "HB-INTUNE-Test"
AVD FSLogix Configuration Consistency Assessment#CredCode#$TargetHostsInPools = "HB-INTUNE-Test:HB-AVD-INTN-0"
AVD FSLogix Configuration Consistency Assessment#CredCode#
AVD FSLogix Configuration Consistency Assessment#CredCode#$STR = "Scoped Host Pools: $ScopedHostPools"
AVD FSLogix Configuration Consistency Assessment#CredCode#Add-Content $FinalLogFile $STR
AVD FSLogix Configuration Consistency Assessment#CredCode#$STR = "Target Hosts: $TargetHostsInPools"
AVD FSLogix Configuration Consistency Assessment#CredCode#Add-Content $FinalLogFile $STR
AVD FSLogix Configuration Consistency Assessment#CredCode#
AVD FSLogix Configuration Consistency Assessment#CredCode#IF ($TargetHostsInPools -eq "" -or $TargetHostsInPools -eq $null)
AVD FSLogix Configuration Consistency Assessment#CredCode#{
AVD FSLogix Configuration Consistency Assessment#CredCode#	$STR = "Target Hosts NOT Defined..."
AVD FSLogix Configuration Consistency Assessment#CredCode#	Add-Content $FinalLogFile $STR
AVD FSLogix Configuration Consistency Assessment#CredCode#	$STR = "Aborting..."
AVD FSLogix Configuration Consistency Assessment#CredCode#	Add-Content $FinalLogFile $STR
AVD FSLogix Configuration Consistency Assessment#CredCode#}
AVD FSLogix Configuration Consistency Assessment#CredCode#else
AVD FSLogix Configuration Consistency Assessment#CredCode#{
AVD FSLogix Configuration Consistency Assessment#CredCode#	
AVD FSLogix Configuration Consistency Assessment#CredCode#	$AllPoolsFile = "$NewLocNow\public\$TRPKey\Users\TEMP\FSLogixAllHostPools.CSV"
AVD FSLogix Configuration Consistency Assessment#CredCode#	Remove-Item $AllPoolsFile -ErrorAction SilentlyContinue
AVD FSLogix Configuration Consistency Assessment#CredCode#	$STR = "Host Pool,"
AVD FSLogix Configuration Consistency Assessment#CredCode#	Add-Content $AllPoolsFile $STR
AVD FSLogix Configuration Consistency Assessment#CredCode#	
AVD FSLogix Configuration Consistency Assessment#CredCode#	$SplitPools = $ScopedHostPools.Split(",")
AVD FSLogix Configuration Consistency Assessment#CredCode#	$R = Get-AzWvdHostPool | Select-Object *
AVD FSLogix Configuration Consistency Assessment#CredCode#	$AllPoolsNow = ""
AVD FSLogix Configuration Consistency Assessment#CredCode#	ForEach ($Item in $R)
AVD FSLogix Configuration Consistency Assessment#CredCode#	{
AVD FSLogix Configuration Consistency Assessment#CredCode#		$HostPool = $Item.Name
AVD FSLogix Configuration Consistency Assessment#CredCode#		$ThisLine = $Item.ApplicationGroupReference
AVD FSLogix Configuration Consistency Assessment#CredCode#		$R = $ThisLine
AVD FSLogix Configuration Consistency Assessment#CredCode#		$A, $B, $C, $D, $E, $F = $R.Split("/")
AVD FSLogix Configuration Consistency Assessment#CredCode#		
AVD FSLogix Configuration Consistency Assessment#CredCode#		$FinalResGroup = $E
AVD FSLogix Configuration Consistency Assessment#CredCode#		
AVD FSLogix Configuration Consistency Assessment#CredCode#		$DoOrNot = "No"
AVD FSLogix Configuration Consistency Assessment#CredCode#		IF ($ScopedHostPools -eq "ALL")
AVD FSLogix Configuration Consistency Assessment#CredCode#		{
AVD FSLogix Configuration Consistency Assessment#CredCode#			$DoOrNot = "Yes"
AVD FSLogix Configuration Consistency Assessment#CredCode#		}
AVD FSLogix Configuration Consistency Assessment#CredCode#		else
AVD FSLogix Configuration Consistency Assessment#CredCode#		{
AVD FSLogix Configuration Consistency Assessment#CredCode#			$SplittedPools = $ScopedHostPools.Split(",")
AVD FSLogix Configuration Consistency Assessment#CredCode#			foreach ($SplitPool in $SplittedPools)
AVD FSLogix Configuration Consistency Assessment#CredCode#			{
AVD FSLogix Configuration Consistency Assessment#CredCode#				IF ($SplitPool.ToLower() -eq $HostPool.ToLower())
AVD FSLogix Configuration Consistency Assessment#CredCode#				{
AVD FSLogix Configuration Consistency Assessment#CredCode#					$DoOrNot = "Yes"
AVD FSLogix Configuration Consistency Assessment#CredCode#					break
AVD FSLogix Configuration Consistency Assessment#CredCode#				}
AVD FSLogix Configuration Consistency Assessment#CredCode#			}
AVD FSLogix Configuration Consistency Assessment#CredCode#		}
AVD FSLogix Configuration Consistency Assessment#CredCode#		IF ($DoOrNot -eq "Yes")
AVD FSLogix Configuration Consistency Assessment#CredCode#		{
AVD FSLogix Configuration Consistency Assessment#CredCode#			$STR = $HostPool + ","
AVD FSLogix Configuration Consistency Assessment#CredCode#			Add-Content $AllPoolsFile $STR
AVD FSLogix Configuration Consistency Assessment#CredCode#			
AVD FSLogix Configuration Consistency Assessment#CredCode#			$AllPoolsNow = $Item.Name + "," + $AllPoolsNow
AVD FSLogix Configuration Consistency Assessment#CredCode#			
AVD FSLogix Configuration Consistency Assessment#CredCode#			$STR = "Processing Host Pool: " + $HostPool
AVD FSLogix Configuration Consistency Assessment#CredCode#			Add-Content $FinalLogFile $STR
AVD FSLogix Configuration Consistency Assessment#CredCode#			$STR = "Resource Group: " + $FinalResGroup
AVD FSLogix Configuration Consistency Assessment#CredCode#			Add-Content $FinalLogFile $STR
AVD FSLogix Configuration Consistency Assessment#CredCode#			
AVD FSLogix Configuration Consistency Assessment#CredCode#			$FinalHostToTarget = "NONE"
AVD FSLogix Configuration Consistency Assessment#CredCode#			
AVD FSLogix Configuration Consistency Assessment#CredCode#			$SplitedHosts = $TargetHostsInPools.Split(",")
AVD FSLogix Configuration Consistency Assessment#CredCode#			foreach ($TaregtHost in $SplitedHosts)
AVD FSLogix Configuration Consistency Assessment#CredCode#			{
AVD FSLogix Configuration Consistency Assessment#CredCode#				$A, $B = $TaregtHost.split(":")
AVD FSLogix Configuration Consistency Assessment#CredCode#				IF ($A.ToLower() -eq $HostPool)
AVD FSLogix Configuration Consistency Assessment#CredCode#				{
AVD FSLogix Configuration Consistency Assessment#CredCode#					$FinalHostToTarget = $B
AVD FSLogix Configuration Consistency Assessment#CredCode#				}
AVD FSLogix Configuration Consistency Assessment#CredCode#			}
AVD FSLogix Configuration Consistency Assessment#CredCode#			
AVD FSLogix Configuration Consistency Assessment#CredCode#			$STR = "Host To Target: " + $FinalHostToTarget
AVD FSLogix Configuration Consistency Assessment#CredCode#			Add-Content $FinalLogFile $STR
AVD FSLogix Configuration Consistency Assessment#CredCode#			
AVD FSLogix Configuration Consistency Assessment#CredCode#			$FSLogixResultFileProfC = "$NewLocNow\public\$TRPKey\Users\TEMP\" + $HostPool + "_" + $FinalHostToTarget + "PROF_Container.CSV"
AVD FSLogix Configuration Consistency Assessment#CredCode#			Remove-Item $FSLogixResultFileProfC -ErrorAction SilentlyContinue
AVD FSLogix Configuration Consistency Assessment#CredCode#			$FSLogixResultFileODFCC = "$NewLocNow\public\$TRPKey\Users\TEMP\" + $HostPool + "_" + $FinalHostToTarget + "ODFC_Container.CSV"
AVD FSLogix Configuration Consistency Assessment#CredCode#			Remove-Item $FSLogixResultFileODFCC -ErrorAction SilentlyContinue
AVD FSLogix Configuration Consistency Assessment#CredCode#			
AVD FSLogix Configuration Consistency Assessment#CredCode#			$STR = "Checking VM Status: " + $FinalHostToTarget
AVD FSLogix Configuration Consistency Assessment#CredCode#			Add-Content $FinalLogFile $STR
AVD FSLogix Configuration Consistency Assessment#CredCode#			
AVD FSLogix Configuration Consistency Assessment#CredCode#			$AllGoodOrNot = "Yes"
AVD FSLogix Configuration Consistency Assessment#CredCode#			$Error.Clear()
AVD FSLogix Configuration Consistency Assessment#CredCode#			
AVD FSLogix Configuration Consistency Assessment#CredCode#			$AllVMs = Get-AzVM -Name $FinalHostToTarget -Status | Select-Object Name, PowerState
AVD FSLogix Configuration Consistency Assessment#CredCode#			IF ($Error.Count -eq 0)
AVD FSLogix Configuration Consistency Assessment#CredCode#			{
AVD FSLogix Configuration Consistency Assessment#CredCode#				foreach ($VM in $AllVMs)
AVD FSLogix Configuration Consistency Assessment#CredCode#				{
AVD FSLogix Configuration Consistency Assessment#CredCode#					IF ($VM.Name.ToLower() -eq $FinalHostToTarget.ToLower())
AVD FSLogix Configuration Consistency Assessment#CredCode#					{
AVD FSLogix Configuration Consistency Assessment#CredCode#						IF ($VM.PowerState -eq "VM running")
AVD FSLogix Configuration Consistency Assessment#CredCode#						{
AVD FSLogix Configuration Consistency Assessment#CredCode#							$EXEVMStatus = "VM Running"
AVD FSLogix Configuration Consistency Assessment#CredCode#							$STR = "VM is running"
AVD FSLogix Configuration Consistency Assessment#CredCode#							Add-Content $FinalLogFile $STR
AVD FSLogix Configuration Consistency Assessment#CredCode#						}
AVD FSLogix Configuration Consistency Assessment#CredCode#						else
AVD FSLogix Configuration Consistency Assessment#CredCode#						{
AVD FSLogix Configuration Consistency Assessment#CredCode#							$EXEVMStatus = "VM NOT Running"
AVD FSLogix Configuration Consistency Assessment#CredCode#							$STR = "VM is NOT running"
AVD FSLogix Configuration Consistency Assessment#CredCode#							Add-Content $FinalLogFile $STR
AVD FSLogix Configuration Consistency Assessment#CredCode#							$AllGoodOrNot = "No"
AVD FSLogix Configuration Consistency Assessment#CredCode#						}
AVD FSLogix Configuration Consistency Assessment#CredCode#						break
AVD FSLogix Configuration Consistency Assessment#CredCode#					}
AVD FSLogix Configuration Consistency Assessment#CredCode#				}
AVD FSLogix Configuration Consistency Assessment#CredCode#			}
AVD FSLogix Configuration Consistency Assessment#CredCode#			else
AVD FSLogix Configuration Consistency Assessment#CredCode#			{
AVD FSLogix Configuration Consistency Assessment#CredCode#				$STR = "Error Checking VM Status: " + $Error
AVD FSLogix Configuration Consistency Assessment#CredCode#				Add-Content $FinalLogFile $STR
AVD FSLogix Configuration Consistency Assessment#CredCode#				$AllGoodOrNot = "No"
AVD FSLogix Configuration Consistency Assessment#CredCode#			}
AVD FSLogix Configuration Consistency Assessment#CredCode#			
AVD FSLogix Configuration Consistency Assessment#CredCode#			IF ($AllGoodOrNot -eq "Yes")
AVD FSLogix Configuration Consistency Assessment#CredCode#			{
AVD FSLogix Configuration Consistency Assessment#CredCode#				$AllJobsFile = "$NewLocNow\Public\$TRPKey\Users\TEMP\AllJobs.CSV"
AVD FSLogix Configuration Consistency Assessment#CredCode#				Remove-Item $AllJobsFile -ErrorAction SilentlyContinue
AVD FSLogix Configuration Consistency Assessment#CredCode#				$STR = "JobID,HostName"
AVD FSLogix Configuration Consistency Assessment#CredCode#				Add-Content $AllJobsFile $STR
AVD FSLogix Configuration Consistency Assessment#CredCode#				
AVD FSLogix Configuration Consistency Assessment#CredCode#				$STR = "Triggering Job for VM: " + $FinalHostToTarget
AVD FSLogix Configuration Consistency Assessment#CredCode#				Add-Content $FinalLogFile $STR
AVD FSLogix Configuration Consistency Assessment#CredCode#				
AVD FSLogix Configuration Consistency Assessment#CredCode#				$FinalScriptPath = "$NewLocNow\Public\DPConfig\DPCode\VMScriptTest.ps1"
AVD FSLogix Configuration Consistency Assessment#CredCode#				
AVD FSLogix Configuration Consistency Assessment#CredCode#				$Error.Clear()
AVD FSLogix Configuration Consistency Assessment#CredCode#				$Status = Invoke-AzVMRunCommand -ResourceGroupName $FinalResGroup -Name $FinalHostToTarget -CommandId 'RunPowerShellScript' -ScriptPath "$FinalScriptPath" -AsJob
AVD FSLogix Configuration Consistency Assessment#CredCode#				$ThisJobID = $Status.ID.ToString() + "," + $ThisHostName
AVD FSLogix Configuration Consistency Assessment#CredCode#				Add-Content $AllJobsFile $ThisJobID
AVD FSLogix Configuration Consistency Assessment#CredCode#				
AVD FSLogix Configuration Consistency Assessment#CredCode#				$STR = "Checking to see if Job Was completed for VM: " + $FinalHostToTarget
AVD FSLogix Configuration Consistency Assessment#CredCode#				Add-Content $FinalLogFile $STR
AVD FSLogix Configuration Consistency Assessment#CredCode#				
AVD FSLogix Configuration Consistency Assessment#CredCode#				$TimeStart = Get-Date
AVD FSLogix Configuration Consistency Assessment#CredCode#				$TimeEnd = $timeStart.addminutes(8)
AVD FSLogix Configuration Consistency Assessment#CredCode#				Do
AVD FSLogix Configuration Consistency Assessment#CredCode#				{
AVD FSLogix Configuration Consistency Assessment#CredCode#					$AllJobsFileCSV = Import-Csv $AllJobsFile
AVD FSLogix Configuration Consistency Assessment#CredCode#					
AVD FSLogix Configuration Consistency Assessment#CredCode#					$TimeNow = Get-Date
AVD FSLogix Configuration Consistency Assessment#CredCode#					
AVD FSLogix Configuration Consistency Assessment#CredCode#					$STR = "Status - 8 Minutes to run: Start: " + $TimeStart.ToString() + " Now: " + $TimeNow.ToString()
AVD FSLogix Configuration Consistency Assessment#CredCode#					Add-Content $FinalLogFile $STR
AVD FSLogix Configuration Consistency Assessment#CredCode#					
AVD FSLogix Configuration Consistency Assessment#CredCode#					if ($TimeNow -ge $TimeEnd)
AVD FSLogix Configuration Consistency Assessment#CredCode#					{
AVD FSLogix Configuration Consistency Assessment#CredCode#						foreach ($JobIDNow in $AllJobsFileCSV)
AVD FSLogix Configuration Consistency Assessment#CredCode#						{
AVD FSLogix Configuration Consistency Assessment#CredCode#							$ThisHostName = $JobIDNow.HostName
AVD FSLogix Configuration Consistency Assessment#CredCode#							$ThisJobID = $JobIDNow.JobID
AVD FSLogix Configuration Consistency Assessment#CredCode#							Stop-Job -Id $ThisJobID
AVD FSLogix Configuration Consistency Assessment#CredCode#							Remove-Job -Id $ThisJobID -Force
AVD FSLogix Configuration Consistency Assessment#CredCode#							
AVD FSLogix Configuration Consistency Assessment#CredCode#							$STR = "Job was removed: ID: " + $ThisJobID + " For Host: " + $ThisHostName
AVD FSLogix Configuration Consistency Assessment#CredCode#							Add-Content $FinalLogFile $STR
AVD FSLogix Configuration Consistency Assessment#CredCode#							$STR = "Error: Took Longer time to completed for VM: $FinalHostToTarget"
AVD FSLogix Configuration Consistency Assessment#CredCode#							Add-Content $FinalLogFile $STR
AVD FSLogix Configuration Consistency Assessment#CredCode#							$STR = "Aborting for VM: $FinalHostToTarget"
AVD FSLogix Configuration Consistency Assessment#CredCode#							Add-Content $FinalLogFile $STR
AVD FSLogix Configuration Consistency Assessment#CredCode#							
AVD FSLogix Configuration Consistency Assessment#CredCode#							$AllGoodOrNot = "No"
AVD FSLogix Configuration Consistency Assessment#CredCode#						}
AVD FSLogix Configuration Consistency Assessment#CredCode#					}
AVD FSLogix Configuration Consistency Assessment#CredCode#					else
AVD FSLogix Configuration Consistency Assessment#CredCode#					{
AVD FSLogix Configuration Consistency Assessment#CredCode#					}
AVD FSLogix Configuration Consistency Assessment#CredCode#					
AVD FSLogix Configuration Consistency Assessment#CredCode#					Start-Sleep -Seconds 10
AVD FSLogix Configuration Consistency Assessment#CredCode#					
AVD FSLogix Configuration Consistency Assessment#CredCode#					$DoneOrNot = "Yes"
AVD FSLogix Configuration Consistency Assessment#CredCode#					foreach ($JobIDNow in $AllJobsFileCSV)
AVD FSLogix Configuration Consistency Assessment#CredCode#					{
AVD FSLogix Configuration Consistency Assessment#CredCode#						$ThisJobID = $JobIDNow.JobID
AVD FSLogix Configuration Consistency Assessment#CredCode#						$FinalJobID = $ThisJobID
AVD FSLogix Configuration Consistency Assessment#CredCode#						$JobStatus = Get-Job -Id $FinalJobID
AVD FSLogix Configuration Consistency Assessment#CredCode#						IF ($JobStatus.State -eq "Running")
AVD FSLogix Configuration Consistency Assessment#CredCode#						{
AVD FSLogix Configuration Consistency Assessment#CredCode#							$DoneOrNot = "No"
AVD FSLogix Configuration Consistency Assessment#CredCode#						}
AVD FSLogix Configuration Consistency Assessment#CredCode#					}
AVD FSLogix Configuration Consistency Assessment#CredCode#					IF ($DoneOrNot -eq "Yes")
AVD FSLogix Configuration Consistency Assessment#CredCode#					{
AVD FSLogix Configuration Consistency Assessment#CredCode#						$AllJobsFileCSV = Import-Csv $AllJobsFile
AVD FSLogix Configuration Consistency Assessment#CredCode#						foreach ($JobIDNow in $AllJobsFileCSV)
AVD FSLogix Configuration Consistency Assessment#CredCode#						{
AVD FSLogix Configuration Consistency Assessment#CredCode#							$ThisHostName = $JobIDNow.HostName
AVD FSLogix Configuration Consistency Assessment#CredCode#							$ThisJobID = $JobIDNow.JobID -as [int]
AVD FSLogix Configuration Consistency Assessment#CredCode#							$JobStatus = Get-Job -Id $ThisJobID
AVD FSLogix Configuration Consistency Assessment#CredCode#							IF ($JobStatus.State -eq "Completed")
AVD FSLogix Configuration Consistency Assessment#CredCode#							{
AVD FSLogix Configuration Consistency Assessment#CredCode#							}
AVD FSLogix Configuration Consistency Assessment#CredCode#						}
AVD FSLogix Configuration Consistency Assessment#CredCode#						
AVD FSLogix Configuration Consistency Assessment#CredCode#						### Stop and Remove all Jobs
AVD FSLogix Configuration Consistency Assessment#CredCode#						foreach ($JobIDNow in $AllJobsFileCSV)
AVD FSLogix Configuration Consistency Assessment#CredCode#						{
AVD FSLogix Configuration Consistency Assessment#CredCode#							$ThisJobID = $JobIDNow.JobID
AVD FSLogix Configuration Consistency Assessment#CredCode#							Stop-Job -Id $ThisJobID
AVD FSLogix Configuration Consistency Assessment#CredCode#							Remove-Job -Id $ThisJobID -Force
AVD FSLogix Configuration Consistency Assessment#CredCode#						}
AVD FSLogix Configuration Consistency Assessment#CredCode#						
AVD FSLogix Configuration Consistency Assessment#CredCode#						$STR = "Job Completed for VM: $FinalHostToTarget"
AVD FSLogix Configuration Consistency Assessment#CredCode#						Add-Content $FinalLogFile $STR
AVD FSLogix Configuration Consistency Assessment#CredCode#						Break
AVD FSLogix Configuration Consistency Assessment#CredCode#					}
AVD FSLogix Configuration Consistency Assessment#CredCode#				}
AVD FSLogix Configuration Consistency Assessment#CredCode#				Until ($TimeNow -ge $TimeEnd)
AVD FSLogix Configuration Consistency Assessment#CredCode#			}
AVD FSLogix Configuration Consistency Assessment#CredCode#			
AVD FSLogix Configuration Consistency Assessment#CredCode#			IF ($AllGoodOrNot -eq "Yes")
AVD FSLogix Configuration Consistency Assessment#CredCode#			{
AVD FSLogix Configuration Consistency Assessment#CredCode#				$STR = "VM Job Test was a Success for VM:" + $FinalHostToTarget
AVD FSLogix Configuration Consistency Assessment#CredCode#				Add-Content $FinalLogFile $STR
AVD FSLogix Configuration Consistency Assessment#CredCode#				
AVD FSLogix Configuration Consistency Assessment#CredCode#				$STR = "Executing Script for Host: " + $FinalHostToTarget
AVD FSLogix Configuration Consistency Assessment#CredCode#				Add-Content $FinalLogFile $STR
AVD FSLogix Configuration Consistency Assessment#CredCode#				
AVD FSLogix Configuration Consistency Assessment#CredCode#				$FinalScriptPath = "$NewLocNow\Public\DPConfig\DPCode\AVD\FSLogixConfigZERO.ps1"
AVD FSLogix Configuration Consistency Assessment#CredCode#				
AVD FSLogix Configuration Consistency Assessment#CredCode#				$Error.Clear()
AVD FSLogix Configuration Consistency Assessment#CredCode#				$Status = Invoke-AzVMRunCommand -ResourceGroupName $FinalResGroup -Name $FinalHostToTarget -CommandId 'RunPowerShellScript' -ScriptPath "$FinalScriptPath"
AVD FSLogix Configuration Consistency Assessment#CredCode#				IF ($Error.Count -eq 0)
AVD FSLogix Configuration Consistency Assessment#CredCode#				{
AVD FSLogix Configuration Consistency Assessment#CredCode#					$STR = "Script Executed Successfully on Host: " + $FinalHostToTarget
AVD FSLogix Configuration Consistency Assessment#CredCode#					Add-Content $FinalLogFile $STR
AVD FSLogix Configuration Consistency Assessment#CredCode#					
AVD FSLogix Configuration Consistency Assessment#CredCode#					$ResTMP = "$NewLocNow\Public\$TRPKey\Users\FSLogixResultsTMP.DPC"
AVD FSLogix Configuration Consistency Assessment#CredCode#					Remove-Item $ResTMP -ErrorAction SilentlyContinue
AVD FSLogix Configuration Consistency Assessment#CredCode#					
AVD FSLogix Configuration Consistency Assessment#CredCode#					$STR = $Status.value[0].Message
AVD FSLogix Configuration Consistency Assessment#CredCode#					Add-Content $ResTMP $STR
AVD FSLogix Configuration Consistency Assessment#CredCode#					foreach ($NewItem in Get-Content $ResTMP)
AVD FSLogix Configuration Consistency Assessment#CredCode#					{
AVD FSLogix Configuration Consistency Assessment#CredCode#						$A, $B = $NewItem.Split(";")
AVD FSLogix Configuration Consistency Assessment#CredCode#						IF ($A -eq "PROFILE" -or $A -eq "PROF")
AVD FSLogix Configuration Consistency Assessment#CredCode#						{
AVD FSLogix Configuration Consistency Assessment#CredCode#							Add-Content $FSLogixResultFileProfC $B
AVD FSLogix Configuration Consistency Assessment#CredCode#						}
AVD FSLogix Configuration Consistency Assessment#CredCode#						IF ($A -eq "ODFC")
AVD FSLogix Configuration Consistency Assessment#CredCode#						{
AVD FSLogix Configuration Consistency Assessment#CredCode#							Add-Content $FSLogixResultFileODFCC $B
AVD FSLogix Configuration Consistency Assessment#CredCode#						}
AVD FSLogix Configuration Consistency Assessment#CredCode#					}
AVD FSLogix Configuration Consistency Assessment#CredCode#				}
AVD FSLogix Configuration Consistency Assessment#CredCode#				else
AVD FSLogix Configuration Consistency Assessment#CredCode#				{
AVD FSLogix Configuration Consistency Assessment#CredCode#					$STR = "Error Executing Script: " + $ThisHostName
AVD FSLogix Configuration Consistency Assessment#CredCode#					Add-Content $FinalLogFile $STR
AVD FSLogix Configuration Consistency Assessment#CredCode#					$STR = "Error: " + $Error
AVD FSLogix Configuration Consistency Assessment#CredCode#					Add-Content $FinalLogFile $STR
AVD FSLogix Configuration Consistency Assessment#CredCode#				}
AVD FSLogix Configuration Consistency Assessment#CredCode#			}
AVD FSLogix Configuration Consistency Assessment#CredCode#		}
AVD FSLogix Configuration Consistency Assessment#CredCode#	}
AVD FSLogix Configuration Consistency Assessment#CredCode#	
AVD FSLogix Configuration Consistency Assessment#CredCode#	$STR = "Script Execution is Over"
AVD FSLogix Configuration Consistency Assessment#CredCode#	Add-Content $FinalLogFile $STR
AVD FSLogix Configuration Consistency Assessment#CredCode#	
AVD FSLogix Configuration Consistency Assessment#CredCode#	$STR = "Collecting Results"
AVD FSLogix Configuration Consistency Assessment#CredCode#	Add-Content $FinalLogFile $STR
AVD FSLogix Configuration Consistency Assessment#CredCode#	
AVD FSLogix Configuration Consistency Assessment#CredCode#	$STR = "FSLogix Setting/Test,Container Type,Consistency Status," + $AllPoolsNow
AVD FSLogix Configuration Consistency Assessment#CredCode#	Add-Content $FinalResultFile $STR
AVD FSLogix Configuration Consistency Assessment#CredCode#	
AVD FSLogix Configuration Consistency Assessment#CredCode#	$FSLogixTestsFile = "$NewLocNow\public\DPConfig\DPCode\AVD\FSLogixContainersTests.CSV"
AVD FSLogix Configuration Consistency Assessment#CredCode#	$PropCSV = Import-Csv $FSLogixTestsFile
AVD FSLogix Configuration Consistency Assessment#CredCode#	
AVD FSLogix Configuration Consistency Assessment#CredCode#	$PoolsCSV = Import-Csv $AllPoolsFile
AVD FSLogix Configuration Consistency Assessment#CredCode#	
AVD FSLogix Configuration Consistency Assessment#CredCode#	foreach ($Item in $PropCSV)
AVD FSLogix Configuration Consistency Assessment#CredCode#	{
AVD FSLogix Configuration Consistency Assessment#CredCode#		$ThisProp = $Item.FSLogixTest.Trim()
AVD FSLogix Configuration Consistency Assessment#CredCode#		$ThisReg = $Item.RegEntry
AVD FSLogix Configuration Consistency Assessment#CredCode#		$ContType = $Item.Type
AVD FSLogix Configuration Consistency Assessment#CredCode#		$DefValue = $Item.ExpValue
AVD FSLogix Configuration Consistency Assessment#CredCode#		$CheckEXPValue = $Item.ExpValue
AVD FSLogix Configuration Consistency Assessment#CredCode#		$FinalProp = '"' + $ThisProp + "`n[" + $ThisReg + "]" + '"'
AVD FSLogix Configuration Consistency Assessment#CredCode#		$ThisDesNow = $Item.Description
AVD FSLogix Configuration Consistency Assessment#CredCode#		
AVD FSLogix Configuration Consistency Assessment#CredCode#		IF ($ThisProp -eq "" -or $ThisProp -eq $null)
AVD FSLogix Configuration Consistency Assessment#CredCode#		{
AVD FSLogix Configuration Consistency Assessment#CredCode#		}
AVD FSLogix Configuration Consistency Assessment#CredCode#		else
AVD FSLogix Configuration Consistency Assessment#CredCode#		{
AVD FSLogix Configuration Consistency Assessment#CredCode#			$ThisFinalPropName = $ThisProp
AVD FSLogix Configuration Consistency Assessment#CredCode#			
AVD FSLogix Configuration Consistency Assessment#CredCode#			$AllDataNow = ""
AVD FSLogix Configuration Consistency Assessment#CredCode#			$FCContainer = New-Object System.Collections.ArrayList
AVD FSLogix Configuration Consistency Assessment#CredCode#			
AVD FSLogix Configuration Consistency Assessment#CredCode#			ForEach ($PoolItem in $PoolsCSV)
AVD FSLogix Configuration Consistency Assessment#CredCode#			{
AVD FSLogix Configuration Consistency Assessment#CredCode#				$ThisHostPoolR = $PoolItem.'Host Pool'
AVD FSLogix Configuration Consistency Assessment#CredCode#				
AVD FSLogix Configuration Consistency Assessment#CredCode#				$FinalHostToTarget = "NONE"
AVD FSLogix Configuration Consistency Assessment#CredCode#				$ValueToAddInCont = ""
AVD FSLogix Configuration Consistency Assessment#CredCode#				
AVD FSLogix Configuration Consistency Assessment#CredCode#				$SplitedHosts = $TargetHostsInPools.Split(",")
AVD FSLogix Configuration Consistency Assessment#CredCode#				foreach ($TaregtHost in $SplitedHosts)
AVD FSLogix Configuration Consistency Assessment#CredCode#				{
AVD FSLogix Configuration Consistency Assessment#CredCode#					$A, $B = $TaregtHost.split(":")
AVD FSLogix Configuration Consistency Assessment#CredCode#					IF ($A.ToLower() -eq $ThisHostPoolR)
AVD FSLogix Configuration Consistency Assessment#CredCode#					{
AVD FSLogix Configuration Consistency Assessment#CredCode#						$FinalHostToTarget = $B
AVD FSLogix Configuration Consistency Assessment#CredCode#					}
AVD FSLogix Configuration Consistency Assessment#CredCode#				}
AVD FSLogix Configuration Consistency Assessment#CredCode#				
AVD FSLogix Configuration Consistency Assessment#CredCode#				$FilesFoundOrNo = "No"
AVD FSLogix Configuration Consistency Assessment#CredCode#				
AVD FSLogix Configuration Consistency Assessment#CredCode#				$FSLogixResultFileProfCCSV = "$NewLocNow\public\$TRPKey\Users\TEMP\" + $ThisHostPoolR + "_" + $FinalHostToTarget + "PROF_Container.CSV"
AVD FSLogix Configuration Consistency Assessment#CredCode#				IF (Test-Path $FSLogixResultFileODFCCCSV)
AVD FSLogix Configuration Consistency Assessment#CredCode#				{
AVD FSLogix Configuration Consistency Assessment#CredCode#					$FilesFoundOrNo = "Yes"
AVD FSLogix Configuration Consistency Assessment#CredCode#				}
AVD FSLogix Configuration Consistency Assessment#CredCode#				$FSLogixResultFileODFCCCSV = "$NewLocNow\public\$TRPKey\Users\TEMP\" + $ThisHostPoolR + "_" + $FinalHostToTarget + "ODFC_Container.CSV"
AVD FSLogix Configuration Consistency Assessment#CredCode#				IF (Test-Path $FSLogixResultFileODFCCCSV)
AVD FSLogix Configuration Consistency Assessment#CredCode#				{
AVD FSLogix Configuration Consistency Assessment#CredCode#					$FilesFoundOrNo = "Yes"
AVD FSLogix Configuration Consistency Assessment#CredCode#				}
AVD FSLogix Configuration Consistency Assessment#CredCode#				
AVD FSLogix Configuration Consistency Assessment#CredCode#				IF ($FilesFoundOrNo -eq "Yes")
AVD FSLogix Configuration Consistency Assessment#CredCode#				{					
AVD FSLogix Configuration Consistency Assessment#CredCode#					IF ($ContType -eq "ProfileContainer")
AVD FSLogix Configuration Consistency Assessment#CredCode#					{
AVD FSLogix Configuration Consistency Assessment#CredCode#						$CSVTestFile = Get-Content $FSLogixResultFileProfCCSV
AVD FSLogix Configuration Consistency Assessment#CredCode#					}
AVD FSLogix Configuration Consistency Assessment#CredCode#					IF ($ContType -eq "OfficeContainer")
AVD FSLogix Configuration Consistency Assessment#CredCode#					{
AVD FSLogix Configuration Consistency Assessment#CredCode#						$CSVTestFile = Get-Content $FSLogixResultFileODFCCCSV
AVD FSLogix Configuration Consistency Assessment#CredCode#					}
AVD FSLogix Configuration Consistency Assessment#CredCode#					
AVD FSLogix Configuration Consistency Assessment#CredCode#					$FoundORNot = "No"
AVD FSLogix Configuration Consistency Assessment#CredCode#					
AVD FSLogix Configuration Consistency Assessment#CredCode#					$GotFinalPropNameNow = $DefValue
AVD FSLogix Configuration Consistency Assessment#CredCode#					foreach ($ItemCSV in $CSVTestFile)
AVD FSLogix Configuration Consistency Assessment#CredCode#					{
AVD FSLogix Configuration Consistency Assessment#CredCode#						$A, $B = $ItemCSV.Split(":")
AVD FSLogix Configuration Consistency Assessment#CredCode#						$FinalA = $A.Trim()
AVD FSLogix Configuration Consistency Assessment#CredCode#						$FinalB = $B.Trim()
AVD FSLogix Configuration Consistency Assessment#CredCode#						
AVD FSLogix Configuration Consistency Assessment#CredCode#						$FinalValueSet = $FinalB
AVD FSLogix Configuration Consistency Assessment#CredCode#						IF ($ThisReg -eq $FinalA)
AVD FSLogix Configuration Consistency Assessment#CredCode#						{
AVD FSLogix Configuration Consistency Assessment#CredCode#							$ThisCentDiv = '<div style="text-align: center;">' + $FinalValueSet + '</div>'							
AVD FSLogix Configuration Consistency Assessment#CredCode#							$GotFinalPropNameNow = $ThisCentDiv
AVD FSLogix Configuration Consistency Assessment#CredCode#							$FoundORNot = "Yes"
AVD FSLogix Configuration Consistency Assessment#CredCode#							$ValueToAddInCont = $FinalValueSet
AVD FSLogix Configuration Consistency Assessment#CredCode#							break
AVD FSLogix Configuration Consistency Assessment#CredCode#						}
AVD FSLogix Configuration Consistency Assessment#CredCode#					}
AVD FSLogix Configuration Consistency Assessment#CredCode#					
AVD FSLogix Configuration Consistency Assessment#CredCode#					IF ($FoundORNot -eq "No")
AVD FSLogix Configuration Consistency Assessment#CredCode#					{
AVD FSLogix Configuration Consistency Assessment#CredCode#						$FinalNowNew = '<span class="FSLogixNotFoundClass">Not Set</span><br>'
AVD FSLogix Configuration Consistency Assessment#CredCode#						$DefPropClass = '<div class = "RDPPropSomethingWrong">' + $FinalNowNew + '</div>'
AVD FSLogix Configuration Consistency Assessment#CredCode#						$GotFinalPropNameNow = $DefPropClass
AVD FSLogix Configuration Consistency Assessment#CredCode#						$ValueToAddInCont = "Not Set"
AVD FSLogix Configuration Consistency Assessment#CredCode#					}
AVD FSLogix Configuration Consistency Assessment#CredCode#					
AVD FSLogix Configuration Consistency Assessment#CredCode#					$ContFoundOrNot = "No"
AVD FSLogix Configuration Consistency Assessment#CredCode#					foreach ($FItem in $FCContainer)
AVD FSLogix Configuration Consistency Assessment#CredCode#					{
AVD FSLogix Configuration Consistency Assessment#CredCode#						IF ($FItem -eq $ValueToAddInCont)
AVD FSLogix Configuration Consistency Assessment#CredCode#						{
AVD FSLogix Configuration Consistency Assessment#CredCode#							$ContFoundOrNot = "Yes"
AVD FSLogix Configuration Consistency Assessment#CredCode#							break
AVD FSLogix Configuration Consistency Assessment#CredCode#						}
AVD FSLogix Configuration Consistency Assessment#CredCode#					}
AVD FSLogix Configuration Consistency Assessment#CredCode#					
AVD FSLogix Configuration Consistency Assessment#CredCode#					IF ($ContFoundOrNot -eq "No")
AVD FSLogix Configuration Consistency Assessment#CredCode#					{
AVD FSLogix Configuration Consistency Assessment#CredCode#						$CompletedText = $ValueToAddInCont
AVD FSLogix Configuration Consistency Assessment#CredCode#						$FCContainer.Add($CompletedText) > $null
AVD FSLogix Configuration Consistency Assessment#CredCode#					}
AVD FSLogix Configuration Consistency Assessment#CredCode#					
AVD FSLogix Configuration Consistency Assessment#CredCode#					$AllDataNow = $GotFinalPropNameNow + "," + $AllDataNow
AVD FSLogix Configuration Consistency Assessment#CredCode#				}
AVD FSLogix Configuration Consistency Assessment#CredCode#				else
AVD FSLogix Configuration Consistency Assessment#CredCode#				{
AVD FSLogix Configuration Consistency Assessment#CredCode#					$GotFinalPropNameNow = "Result File Not Found"
AVD FSLogix Configuration Consistency Assessment#CredCode#					$AllDataNow = $GotFinalPropNameNow + "," + $AllDataNow
AVD FSLogix Configuration Consistency Assessment#CredCode#					$ValueToAddInCont = "Result File Not Found"					 
AVD FSLogix Configuration Consistency Assessment#CredCode#				}								
AVD FSLogix Configuration Consistency Assessment#CredCode#			}
AVD FSLogix Configuration Consistency Assessment#CredCode#			
AVD FSLogix Configuration Consistency Assessment#CredCode#			$ConsistencyStatus = "Consistent"
AVD FSLogix Configuration Consistency Assessment#CredCode#			IF ($FCContainer.Count -gt 1)
AVD FSLogix Configuration Consistency Assessment#CredCode#			{
AVD FSLogix Configuration Consistency Assessment#CredCode#				$ConsistencyStatus = "Inconsistent"
AVD FSLogix Configuration Consistency Assessment#CredCode#			}
AVD FSLogix Configuration Consistency Assessment#CredCode#			else
AVD FSLogix Configuration Consistency Assessment#CredCode#			{
AVD FSLogix Configuration Consistency Assessment#CredCode#				$ConsistencyStatus = "Consistent"
AVD FSLogix Configuration Consistency Assessment#CredCode#			}
AVD FSLogix Configuration Consistency Assessment#CredCode#			
AVD FSLogix Configuration Consistency Assessment#CredCode#			$InsertRegEnt = '<br><p class="FSLogixRegEntNameClass">' + $ThisReg + '</p>'
AVD FSLogix Configuration Consistency Assessment#CredCode#			$PropClassHere = '<span class = "RDPPropPropNameClass">' + $ThisProp + $InsertRegEnt + '</span><div class = "RDPPropDescriptionSet">' + $ThisDesNow + '</div>'
AVD FSLogix Configuration Consistency Assessment#CredCode#			$STR = $PropClassHere + "," + $ContType + "," + $ConsistencyStatus + "," + $AllDataNow			
AVD FSLogix Configuration Consistency Assessment#CredCode#			Add-Content $FinalResultFile $STR
AVD FSLogix Configuration Consistency Assessment#CredCode#			
AVD FSLogix Configuration Consistency Assessment#CredCode#		}
AVD FSLogix Configuration Consistency Assessment#CredCode#	}
AVD FSLogix Configuration Consistency Assessment#CredCode#	
AVD FSLogix Configuration Consistency Assessment#CredCode#}
AVD FSLogix Configuration Consistency Assessment#CredCode#
AVD FSLogix Configuration Consistency Assessment#CredCode#
