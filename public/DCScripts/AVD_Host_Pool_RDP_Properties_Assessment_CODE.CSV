AVD Host Pool RDP Properties Assessment#CredCode#$ScopedHostPools = "ALL"
AVD Host Pool RDP Properties Assessment#CredCode#$GetPropDes = "Yes"
AVD Host Pool RDP Properties Assessment#CredCode#
AVD Host Pool RDP Properties Assessment#CredCode#$TestCSVFile = "$NewLocNow\public\$TRPKey\Users\TEMP\RDPData.CSV"
AVD Host Pool RDP Properties Assessment#CredCode#Remove-Item $TestCSVFile -ErrorAction SilentlyContinue
AVD Host Pool RDP Properties Assessment#CredCode#$STR = "Host Pool, RDP Property, Value 1, Value 2, Status"
AVD Host Pool RDP Properties Assessment#CredCode#Add-Content $TestCSVFile $STR
AVD Host Pool RDP Properties Assessment#CredCode#
AVD Host Pool RDP Properties Assessment#CredCode#$AllPoolsFile = "$NewLocNow\public\$TRPKey\Users\TEMP\AllHostPools.CSV"
AVD Host Pool RDP Properties Assessment#CredCode#Remove-Item $AllPoolsFile -ErrorAction SilentlyContinue
AVD Host Pool RDP Properties Assessment#CredCode#$STR = "Host Pool,"
AVD Host Pool RDP Properties Assessment#CredCode#Add-Content $AllPoolsFile $STR
AVD Host Pool RDP Properties Assessment#CredCode#
AVD Host Pool RDP Properties Assessment#CredCode#$TenantRDPPropFile = $FinalResultFile
AVD Host Pool RDP Properties Assessment#CredCode#Remove-Item $TenantRDPPropFile -ErrorAction SilentlyContinue
AVD Host Pool RDP Properties Assessment#CredCode#
AVD Host Pool RDP Properties Assessment#CredCode#$R = Get-AzWvdHostPool | Select-Object *
AVD Host Pool RDP Properties Assessment#CredCode#$AllPoolsNow = ""
AVD Host Pool RDP Properties Assessment#CredCode#ForEach ($Item in $R)
AVD Host Pool RDP Properties Assessment#CredCode#{
AVD Host Pool RDP Properties Assessment#CredCode#	$HostPool = $Item.Name
AVD Host Pool RDP Properties Assessment#CredCode#	$AllProp = $Item.CustomRDPProperty
AVD Host Pool RDP Properties Assessment#CredCode#	
AVD Host Pool RDP Properties Assessment#CredCode#	$DoOrNot = "No"
AVD Host Pool RDP Properties Assessment#CredCode#	IF ($ScopedHostPools -eq "ALL")
AVD Host Pool RDP Properties Assessment#CredCode#	{
AVD Host Pool RDP Properties Assessment#CredCode#		$DoOrNot = "Yes"
AVD Host Pool RDP Properties Assessment#CredCode#		
AVD Host Pool RDP Properties Assessment#CredCode#	}
AVD Host Pool RDP Properties Assessment#CredCode#	else
AVD Host Pool RDP Properties Assessment#CredCode#	{
AVD Host Pool RDP Properties Assessment#CredCode#		$SplittedPools = $ScopedHostPools.Split(",")
AVD Host Pool RDP Properties Assessment#CredCode#		foreach ($SplitPool in $SplittedPools)
AVD Host Pool RDP Properties Assessment#CredCode#		{
AVD Host Pool RDP Properties Assessment#CredCode#			IF ($SplitPool.ToLower() -eq $HostPool.ToLower())
AVD Host Pool RDP Properties Assessment#CredCode#			{
AVD Host Pool RDP Properties Assessment#CredCode#				$DoOrNot = "Yes"
AVD Host Pool RDP Properties Assessment#CredCode#				break
AVD Host Pool RDP Properties Assessment#CredCode#				
AVD Host Pool RDP Properties Assessment#CredCode#			}
AVD Host Pool RDP Properties Assessment#CredCode#			
AVD Host Pool RDP Properties Assessment#CredCode#		}
AVD Host Pool RDP Properties Assessment#CredCode#		
AVD Host Pool RDP Properties Assessment#CredCode#	}
AVD Host Pool RDP Properties Assessment#CredCode#	IF ($DoOrNot -eq "Yes")
AVD Host Pool RDP Properties Assessment#CredCode#	{
AVD Host Pool RDP Properties Assessment#CredCode#		
AVD Host Pool RDP Properties Assessment#CredCode#		$STR = $HostPool + ","
AVD Host Pool RDP Properties Assessment#CredCode#		Add-Content $AllPoolsFile $STR
AVD Host Pool RDP Properties Assessment#CredCode#		
AVD Host Pool RDP Properties Assessment#CredCode#		$AllPoolsNow = $Item.Name + "," + $AllPoolsNow
AVD Host Pool RDP Properties Assessment#CredCode#		
AVD Host Pool RDP Properties Assessment#CredCode#		$T = $AllProp.Split(";")
AVD Host Pool RDP Properties Assessment#CredCode#		$TotLen = $T.Length
AVD Host Pool RDP Properties Assessment#CredCode#		for ($num = 1; $num -le $TotLen; $num++)
AVD Host Pool RDP Properties Assessment#CredCode#		{
AVD Host Pool RDP Properties Assessment#CredCode#			$CompleteProp = $T[$num]
AVD Host Pool RDP Properties Assessment#CredCode#			$A, $B, $C, $D = $CompleteProp.Split(":")
AVD Host Pool RDP Properties Assessment#CredCode#			
AVD Host Pool RDP Properties Assessment#CredCode#			$RDPPRop = $A
AVD Host Pool RDP Properties Assessment#CredCode#			$ValueOne = $B
AVD Host Pool RDP Properties Assessment#CredCode#			$ValueTwo = $C
AVD Host Pool RDP Properties Assessment#CredCode#			
AVD Host Pool RDP Properties Assessment#CredCode#			IF ($RDPPRop -eq "" -or $RDPPRop -eq $null)
AVD Host Pool RDP Properties Assessment#CredCode#			{
AVD Host Pool RDP Properties Assessment#CredCode#				
AVD Host Pool RDP Properties Assessment#CredCode#			}
AVD Host Pool RDP Properties Assessment#CredCode#			else
AVD Host Pool RDP Properties Assessment#CredCode#			{
AVD Host Pool RDP Properties Assessment#CredCode#				$STR = $HostPool + "," + $RDPPRop + "," + $ValueOne + "," + $ValueTwo
AVD Host Pool RDP Properties Assessment#CredCode#				Add-Content $TestCSVFile $STR
AVD Host Pool RDP Properties Assessment#CredCode#				
AVD Host Pool RDP Properties Assessment#CredCode#			}
AVD Host Pool RDP Properties Assessment#CredCode#			
AVD Host Pool RDP Properties Assessment#CredCode#		}
AVD Host Pool RDP Properties Assessment#CredCode#		
AVD Host Pool RDP Properties Assessment#CredCode#	}
AVD Host Pool RDP Properties Assessment#CredCode#	
AVD Host Pool RDP Properties Assessment#CredCode#}
AVD Host Pool RDP Properties Assessment#CredCode#
AVD Host Pool RDP Properties Assessment#CredCode#$STR = "RDP Property,Consistency Status," + $AllPoolsNow
AVD Host Pool RDP Properties Assessment#CredCode#Add-Content $TenantRDPPropFile $STR
AVD Host Pool RDP Properties Assessment#CredCode#
AVD Host Pool RDP Properties Assessment#CredCode#$RDPPropFile = "$NewLocNow\public\DPConfig\DPCode\AVD\RDPProperties.CSV"
AVD Host Pool RDP Properties Assessment#CredCode#$PropCSV = Import-Csv $RDPPropFile
AVD Host Pool RDP Properties Assessment#CredCode#
AVD Host Pool RDP Properties Assessment#CredCode#$CSVTestFile = Import-CSV $TestCSVFile
AVD Host Pool RDP Properties Assessment#CredCode#$PoolsCSV = Import-Csv $AllPoolsFile
AVD Host Pool RDP Properties Assessment#CredCode#
AVD Host Pool RDP Properties Assessment#CredCode#foreach ($Item in $PropCSV)
AVD Host Pool RDP Properties Assessment#CredCode#{
AVD Host Pool RDP Properties Assessment#CredCode#	$ThisProp = $Item.RDPProp.Trim()
AVD Host Pool RDP Properties Assessment#CredCode#	$DefValue = "Not Set: Default:" + $Item.'DefaultValue'
AVD Host Pool RDP Properties Assessment#CredCode#	
AVD Host Pool RDP Properties Assessment#CredCode#	IF ($GetPropDes -eq "Yes")
AVD Host Pool RDP Properties Assessment#CredCode#	{
AVD Host Pool RDP Properties Assessment#CredCode#		$PropHelp1 = $Item.PropHelp
AVD Host Pool RDP Properties Assessment#CredCode#		$PropHelp2 = $Item.PropHelp2
AVD Host Pool RDP Properties Assessment#CredCode#		$ComHelp = $PropHelp1 + $PropHelp2
AVD Host Pool RDP Properties Assessment#CredCode#		
AVD Host Pool RDP Properties Assessment#CredCode#	}
AVD Host Pool RDP Properties Assessment#CredCode#	
AVD Host Pool RDP Properties Assessment#CredCode#	IF ($ThisProp -eq "" -or $ThisProp -eq $null)
AVD Host Pool RDP Properties Assessment#CredCode#	{
AVD Host Pool RDP Properties Assessment#CredCode#		
AVD Host Pool RDP Properties Assessment#CredCode#	}
AVD Host Pool RDP Properties Assessment#CredCode#	else
AVD Host Pool RDP Properties Assessment#CredCode#	{
AVD Host Pool RDP Properties Assessment#CredCode#		$FinalProp, $A, $B = $ThisProp.Split(":")
AVD Host Pool RDP Properties Assessment#CredCode#		$ThisFinalPropName = $FinalProp
AVD Host Pool RDP Properties Assessment#CredCode#		### Now check this final Prop in TEst CSV File for each host pool.
AVD Host Pool RDP Properties Assessment#CredCode#		
AVD Host Pool RDP Properties Assessment#CredCode#		$AllDataNow = ""
AVD Host Pool RDP Properties Assessment#CredCode#		$FCContainer = New-Object System.Collections.ArrayList
AVD Host Pool RDP Properties Assessment#CredCode#		$ContValueToAdd = ""
AVD Host Pool RDP Properties Assessment#CredCode#		
AVD Host Pool RDP Properties Assessment#CredCode#		ForEach ($PoolItem in $PoolsCSV)
AVD Host Pool RDP Properties Assessment#CredCode#		{
AVD Host Pool RDP Properties Assessment#CredCode#			$ThisHostPoolR = $PoolItem.'Host Pool'
AVD Host Pool RDP Properties Assessment#CredCode#			
AVD Host Pool RDP Properties Assessment#CredCode#			$FoundORNot = "No"
AVD Host Pool RDP Properties Assessment#CredCode#			
AVD Host Pool RDP Properties Assessment#CredCode#			$GotFinalPropNameNow = $DefValue
AVD Host Pool RDP Properties Assessment#CredCode#			foreach ($ItemCSV in $CSVTestFile)
AVD Host Pool RDP Properties Assessment#CredCode#			{
AVD Host Pool RDP Properties Assessment#CredCode#				$ThisHostPool = $ItemCSV."Host Pool"
AVD Host Pool RDP Properties Assessment#CredCode#				$ThisPoolProp = $ItemCSV.'RDP Property'
AVD Host Pool RDP Properties Assessment#CredCode#				$RDPPropValue1 = $ItemCSV.'Value 1'
AVD Host Pool RDP Properties Assessment#CredCode#				$RDPPropValue2 = $ItemCSV.'Value 2'
AVD Host Pool RDP Properties Assessment#CredCode#				
AVD Host Pool RDP Properties Assessment#CredCode#				$FinalValueSet = $ThisPoolProp + ":" + $RDPPropValue1 + ":" + $RDPPropValue2
AVD Host Pool RDP Properties Assessment#CredCode#				IF ($ThisHostPoolR -eq $ThisHostPool -and $ThisPoolProp -eq $ThisFinalPropName)
AVD Host Pool RDP Properties Assessment#CredCode#				{
AVD Host Pool RDP Properties Assessment#CredCode#					$SomethingWrongOrNot = "No"
AVD Host Pool RDP Properties Assessment#CredCode#					
AVD Host Pool RDP Properties Assessment#CredCode#					$ThisPropInGrid = $ThisPoolProp
AVD Host Pool RDP Properties Assessment#CredCode#					IF ($ThisPropInGrid -eq "drivestoredirect" -or $ThisPropInGrid -eq "redirectsmartcards" -or $ThisPropInGrid -eq "devicestoredirect" -or $ThisPropInGrid -eq "redirectclipboard" -or $ThisPropInGrid -eq "redirectprinters" -or $ThisPropInGrid -eq "usbdevicestoredirect")
AVD Host Pool RDP Properties Assessment#CredCode#					{
AVD Host Pool RDP Properties Assessment#CredCode#						$A, $B, $C = $FinalValueSet.Split(":")
AVD Host Pool RDP Properties Assessment#CredCode#						IF ($C -eq "*" -or $C -eq "1")
AVD Host Pool RDP Properties Assessment#CredCode#						{
AVD Host Pool RDP Properties Assessment#CredCode#							$SomethingWrongOrNot = "Yes"
AVD Host Pool RDP Properties Assessment#CredCode#							
AVD Host Pool RDP Properties Assessment#CredCode#						}
AVD Host Pool RDP Properties Assessment#CredCode#						
AVD Host Pool RDP Properties Assessment#CredCode#					}
AVD Host Pool RDP Properties Assessment#CredCode#					
AVD Host Pool RDP Properties Assessment#CredCode#					IF ($SomethingWrongOrNot -eq "Yes")
AVD Host Pool RDP Properties Assessment#CredCode#					{
AVD Host Pool RDP Properties Assessment#CredCode#						$SomeWrong = '<div class = "RDPPropSomethingWrong">' + $FinalValueSet + '</div>'						
AVD Host Pool RDP Properties Assessment#CredCode#					}
AVD Host Pool RDP Properties Assessment#CredCode#					else
AVD Host Pool RDP Properties Assessment#CredCode#					{
AVD Host Pool RDP Properties Assessment#CredCode#						$SomeWrong = '<div class = "RDPPropConfiguredClass">' + $FinalValueSet + '</div>'						
AVD Host Pool RDP Properties Assessment#CredCode#					}
AVD Host Pool RDP Properties Assessment#CredCode#					
AVD Host Pool RDP Properties Assessment#CredCode#					$ContValueToAdd = $FinalValueSet
AVD Host Pool RDP Properties Assessment#CredCode#					$GotFinalPropNameNow = $SomeWrong
AVD Host Pool RDP Properties Assessment#CredCode#					$FoundORNot = "Yes"
AVD Host Pool RDP Properties Assessment#CredCode#					break
AVD Host Pool RDP Properties Assessment#CredCode#					
AVD Host Pool RDP Properties Assessment#CredCode#				}
AVD Host Pool RDP Properties Assessment#CredCode#				
AVD Host Pool RDP Properties Assessment#CredCode#			}
AVD Host Pool RDP Properties Assessment#CredCode#			
AVD Host Pool RDP Properties Assessment#CredCode#			IF ($FoundORNot -eq "No")
AVD Host Pool RDP Properties Assessment#CredCode#			{
AVD Host Pool RDP Properties Assessment#CredCode#				$ThisDefValue = $Item.'DefaultValue'
AVD Host Pool RDP Properties Assessment#CredCode#				$DefPropClass = '<div class="RDPPropNOTSetClass"><span style="font-weight: 600;color: #7d7c7c;font-style: normal;"><span class = "FSLogixNotFoundClass">Not Set</span></span><span style="font-weight: 600;">Default</span>:' + $ThisDefValue + '</div>'
AVD Host Pool RDP Properties Assessment#CredCode#				$GotFinalPropNameNow = $DefPropClass
AVD Host Pool RDP Properties Assessment#CredCode#				$ContValueToAdd = "Not Set"			
AVD Host Pool RDP Properties Assessment#CredCode#			}
AVD Host Pool RDP Properties Assessment#CredCode#			
AVD Host Pool RDP Properties Assessment#CredCode#			$ContFoundOrNot = "No"
AVD Host Pool RDP Properties Assessment#CredCode#			foreach ($FItem in $FCContainer)
AVD Host Pool RDP Properties Assessment#CredCode#			{
AVD Host Pool RDP Properties Assessment#CredCode#				IF ($FItem -eq $ContValueToAdd)
AVD Host Pool RDP Properties Assessment#CredCode#				{
AVD Host Pool RDP Properties Assessment#CredCode#					$ContFoundOrNot = "Yes"
AVD Host Pool RDP Properties Assessment#CredCode#					break
AVD Host Pool RDP Properties Assessment#CredCode#				}
AVD Host Pool RDP Properties Assessment#CredCode#			}
AVD Host Pool RDP Properties Assessment#CredCode#			
AVD Host Pool RDP Properties Assessment#CredCode#			IF ($ContFoundOrNot -eq "No")
AVD Host Pool RDP Properties Assessment#CredCode#			{
AVD Host Pool RDP Properties Assessment#CredCode#				$CompletedText = $ContValueToAdd
AVD Host Pool RDP Properties Assessment#CredCode#				$FCContainer.Add($CompletedText) > $null
AVD Host Pool RDP Properties Assessment#CredCode#			}
AVD Host Pool RDP Properties Assessment#CredCode#			
AVD Host Pool RDP Properties Assessment#CredCode#			$AllDataNow = $GotFinalPropNameNow + "," + $AllDataNow			
AVD Host Pool RDP Properties Assessment#CredCode#		}
AVD Host Pool RDP Properties Assessment#CredCode#		
AVD Host Pool RDP Properties Assessment#CredCode#		$ConsistencyStatus = "Consistent"
AVD Host Pool RDP Properties Assessment#CredCode#		IF ($FCContainer.Count -gt 1)
AVD Host Pool RDP Properties Assessment#CredCode#		{
AVD Host Pool RDP Properties Assessment#CredCode#			$ThisConDiv = '<div class="ConsInconsClassForAVD">Inconsistent</div>'
AVD Host Pool RDP Properties Assessment#CredCode#			$ConsistencyStatus = $ThisConDiv
AVD Host Pool RDP Properties Assessment#CredCode#		}
AVD Host Pool RDP Properties Assessment#CredCode#		else
AVD Host Pool RDP Properties Assessment#CredCode#		{
AVD Host Pool RDP Properties Assessment#CredCode#			$ThisConDiv = '<div class="ConsInconsClassForAVD">Consistent</div>'
AVD Host Pool RDP Properties Assessment#CredCode#			$ConsistencyStatus = $ThisConDiv
AVD Host Pool RDP Properties Assessment#CredCode#		}
AVD Host Pool RDP Properties Assessment#CredCode#		
AVD Host Pool RDP Properties Assessment#CredCode#		$PropClassHere = '<span class = "RDPPropPropNameClass">' + $ThisFinalPropName + '</span><div class = "RDPPropDescriptionSet">' + $ComHelp + '</div>'
AVD Host Pool RDP Properties Assessment#CredCode#		$STR = $PropClassHere + "," + $ConsistencyStatus + "," + $AllDataNow		
AVD Host Pool RDP Properties Assessment#CredCode#		Add-Content $FinalResultFile $STR
AVD Host Pool RDP Properties Assessment#CredCode#		
AVD Host Pool RDP Properties Assessment#CredCode#		
AVD Host Pool RDP Properties Assessment#CredCode#	}
AVD Host Pool RDP Properties Assessment#CredCode#	
AVD Host Pool RDP Properties Assessment#CredCode#}
AVD Host Pool RDP Properties Assessment#CredCode#
AVD Host Pool RDP Properties Assessment#CredCode#
AVD Host Pool RDP Properties Assessment#CredCode#
