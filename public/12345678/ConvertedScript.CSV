$subscriptions = Get-AzSubscription
$results = @()
foreach ($subscription in $subscriptions)
{
    Select-AzSubscription -SubscriptionId $subscription.SubscriptionId
    $vms = Get-AzVM
    foreach ($vm in $vms)
    {
        $result = New-Object PSObject
        $result | Add-Member -MemberType NoteProperty -Name SubscriptionName -Value $subscription.Name
        $result | Add-Member -MemberType NoteProperty -Name VMName -Value $vm.Name
        $result | Add-Member -MemberType NoteProperty -Name VMStatus -Value $vm.PowerState
        $results += $result
    }
}
$results | Export-Csv -Path C:\temp\AzureVMs.csv -NoTypeInformation
